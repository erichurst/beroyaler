<!DOCTYPE html>
<html>
<head>
  <title>Beroyal</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>

<%= yield %>

<%= cloudinary_js_config %>
<%- @overlays = { kcScript: {overlay: 'kc', gravity: :south_east, width: 0.33, x: 8, y: 8},
                  kcRoyals: {overlay: 'Royals', gravity: :south_east, width: 0.33, x: 8, y: 8},
                  kcLogo: {overlay: 'RoyalsLogo', gravity: :south_east, width: 0.33, x: 8, y: 8} } %>
<%- @transform = [{crop: :fit, width: 350, height: 350}, @overlays] %>

<script>
  $(document).ready(function() {
    var overlays = <%= @overlays.to_json.html_safe %>
    // Cloudinary jQuery integration library uses jQuery File Upload widget
    // (see http://blueimp.github.io/jQuery-File-Upload/).
    // Any file input field with cloudinary-fileupload class is automatically
    // wrapped using the File Upload widget and configured for Cloudinary uploads.
    // You can further customize the configuration using .fileupload method
    // as we do below.
    $(".cloudinary-fileupload")
      .fileupload({ 
        // Uncomment the following lines to enable client side image resizing and valiation.
        // Make sure cloudinary/processing is included the js file
        //disableImageResize: false,
        //imageMaxWidth: 800,
        //imageMaxHeight: 600,
        //acceptFileTypes: /(\.|\/)(gif|jpe?g|png|bmp|ico)$/i,
        //maxFileSize: 20000000, // 20MB
        dropZone: "#direct_upload",
        start: function (e) {
          $(".status").text("Starting upload...");
        },
        progress: function (e, data) {
          $(".status").text("Uploading... " + Math.round((data.loaded * 100.0) / data.total) + "%");
        },
        fail: function (e, data) {
          $(".status").text("Upload failed");
        }
      })
      .off("cloudinarydone").on("cloudinarydone", function (e, data) {
        $(".status").text("");
        $.each(overlays, function(kind, overlay) {
          $('.overlays .' + kind + ' .image').html(              
            $.cloudinary.image(data.result.public_id, 
              $.extend({ format: data.result.format, version: data.result.version }, overlay))               
          );
        });
      });
    });
    
</script>
</body>
</html>
